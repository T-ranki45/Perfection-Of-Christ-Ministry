<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfection Of Christ Ministry | Welcome Home</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Montserrat:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <header class="main-header">
      <div class="container">
        <a href="#" class="logo">
          <img src="./image/logo.png" alt="Logo" />
          <span>Perfection Of Christ Ministry</span>
        </a>
        <div class="menu-btn">
          <i class="fas fa-bars"></i>
        </div>
        <nav class="main-nav">
          <ul>
            <li><a href="about.html">About</a></li>
            <li><a href="#messages">Messages</a></li>
            <li><a href="#events">Events</a></li>
            <li class="live-nav-item">
              <a href="#" class="live-nav-link"
                >Live <span class="live-badge-nav"></span
              ></a>
            </li>
            <li><a href="#visit">Visit</a></li>
            <li><a href="#" id="prayer-btn">Prayer</a></li>
            <li><a href="#" class="button">Give</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <section id="hero">
        <video autoplay muted loop playsinline class="hero-video">
          <!-- Replace 'video.mp4' with the path to your actual video file -->
          <source src="./image/Backup-image.mp4" type="video/mp4" />
        </video>
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <p class="hero-pretitle">Welcome to Perfection Of Christ Ministry</p>
          <h1>
            Faith, Hope, and<br />
            <span
              class="txt-type"
              data-wait="3000"
              data-words='["Love", "Grace", "Truth", "Miracles"]'
            ></span>
          </h1>
          <div class="hero-divider"></div>
          <p>Join us for worship this Sunday at 10:00 AM</p>
          <div class="hero-buttons">
            <a href="#visit" class="button">Join Us This Sunday</a>
            <a href="#" class="button btn-live"
              ><i class="fab fa-facebook-f"></i> Watch Live</a
            >
          </div>
        </div>
        <div class="scroll-indicator">
          <span></span>
        </div>
      </section>

      <!-- Live Stream Modal -->
      <div id="live-modal" class="modal">
        <div class="modal-content live-modal-content">
          <span class="close-btn live-close-btn">&times;</span>
          <h2>Live Service</h2>
          <div class="live-stream-grid">
            <div class="video-column">
              <div class="video-container">
                <iframe
                  id="live-video-iframe"
                  width="100%"
                  height="100%"
                  style="border: none; overflow: hidden"
                  scrolling="no"
                  frameborder="0"
                  allow="
                    autoplay;
                    clipboard-write;
                    encrypted-media;
                    picture-in-picture;
                    web-share;
                  "
                ></iframe>
              </div>
            </div>
            <div class="chat-column">
              <iframe
                id="live-chat-iframe"
                width="100%"
                height="100%"
                style="border: none; overflow: hidden"
                scrolling="yes"
                frameborder="0"
                allowTransparency="true"
              ></iframe>
            </div>
          </div>
        </div>
      </div>

      <section id="welcome">
        <div class="container welcome-container">
          <div class="welcome-card reveal-scale">
            <div class="welcome-icon"><i class="fas fa-dove"></i></div>
            <h2>Welcome to <br /><span>Perfection Of Christ Ministry</span></h2>
            <p id="welcome-text">
              We are a community of believers dedicated to knowing God and
              making Him known. Whether you're curious about faith or a lifelong
              follower of Jesus, you are welcome here. We invite you to join us
              as we seek to grow in our relationship with God and with one
              another.
            </p>
          </div>
        </div>
      </section>

      <section id="events">
        <div class="container">
          <h2>Upcoming Services</h2>
          <div class="flyer-stack-container" id="flyer-stack">
            <!-- Flyers will be injected here by JavaScript -->
            <p style="text-align: center; width: 100%; padding-top: 200px">
              Loading services...
            </p>
          </div>
        </div>
      </section>

      <section id="visit">
        <div class="container">
          <h2>We'd Love For You To Visit</h2>
          <div class="visit-content">
            <div class="visit-info">
              <h3>Service Times</h3>
              <p>
                <strong>Sundays</strong><br />
                1st Service: 7:00 AM - 10:00 AM<br />
                2nd Service: 10:00 AM - 12:30 PM
              </p>
              <p>
                <strong>Wednesdays</strong><br />
                Bible Study: 6:00 PM
              </p>
              <h3>Location</h3>
              <p>123 Church Street<br />Anytown, USA 12345</p>
              <h3>What to Expect</h3>
              <p>
                Our services are about 75 minutes long and include contemporary
                worship music and a relevant message from the Bible. Come as you
                are!
              </p>
            </div>
            <div class="map-placeholder">
              <!-- You can embed a Google Map here -->
              <p>[Google Map Placeholder]</p>
            </div>
          </div>
        </div>
      </section>

      <section id="messages">
        <div class="container">
          <h2>Recent Messages</h2>
          <div class="messages-scroll-wrapper">
            <div class="messages-track" id="dynamic-messages-list">
              <p style="text-align: center; width: 100%; color: #fff">
                Loading messages...
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Message Player Modal -->
      <div id="message-modal" class="modal">
        <div class="modal-content live-modal-content">
          <span class="close-btn message-close-btn">&times;</span>
          <h2 id="message-modal-title">Message</h2>
          <div class="video-container" id="message-video-container">
            <!-- Iframe will be injected here -->
          </div>
        </div>
      </div>

      <section id="new-here">
        <div class="verse-container">
          <p class="verse-scroll">
            "For I know the plans I have for you,” declares the Lord, “plans to
            prosper you and not to harm you, plans to give you hope and a
            future." - Jeremiah 29:11 &nbsp; &nbsp; &nbsp; &nbsp;
          </p>
        </div>
      </section>

      <section id="give-section">
        <div class="give-overlay"></div>
        <div class="container">
          <div class="give-content reveal-scale">
            <h2>Generosity</h2>
            <p class="give-scripture">
              "Each of you should give what you have decided in your heart to
              give, not reluctantly or under compulsion, for God loves a
              cheerful giver." <br />— 2 Corinthians 9:7
            </p>

            <div class="giving-reasons-grid">
              <div class="give-card">
                <i class="fas fa-heart"></i>
                <h3>Why We Give</h3>
                <p>
                  Giving is an act of worship and obedience. It acknowledges God
                  as the provider of everything we have and demonstrates our
                  trust in Him.
                </p>
              </div>
              <div class="give-card">
                <i class="fas fa-globe"></i>
                <h3>Kingdom Impact</h3>
                <p>
                  Your generosity supports local outreach, global missions, and
                  the day-to-day operations of the church, helping us spread the
                  Gospel.
                </p>
              </div>
              <div class="give-card">
                <i class="fas fa-hand-holding-usd"></i>
                <h3>Stewardship</h3>
                <p>
                  We are committed to financial integrity and transparency,
                  ensuring that every seed sown is used effectively for the
                  expansion of God's Kingdom.
                </p>
              </div>
            </div>

            <a href="#" class="button btn-outline">Give Online</a>
          </div>
        </div>
      </section>
    </main>

    <a href="#" id="back-to-top" title="Back to Top">↑</a>

    <!-- Prayer Request Modal -->
    <div id="prayer-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Prayer Request</h2>
        <p>How can we pray for you today?</p>
        <form id="prayer-form">
          <div class="form-group">
            <label for="prayer-name">Name</label>
            <input
              type="text"
              id="prayer-name"
              name="name"
              placeholder="Your Name"
              required
            />
          </div>
          <div class="form-group">
            <label for="prayer-email">Email</label>
            <input
              type="email"
              id="prayer-email"
              name="email"
              placeholder="Your Email"
              required
            />
          </div>
          <div class="form-group">
            <label for="prayer-request">Your Request</label>
            <textarea
              id="prayer-request"
              name="request"
              rows="4"
              placeholder="Share your prayer request..."
              required
            ></textarea>
          </div>
          <button type="submit" class="button" style="width: 100%">
            Submit Request
          </button>
        </form>
      </div>
    </div>

    <footer class="main-footer">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-col">
            <h3>Perfection Of Christ Ministry</h3>
            <p>Knowing God and making Him known to the nations.</p>
            <div class="social-links">
              <a
                href="https://www.facebook.com/john.jeremiah.128614"
                title="Facebook"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
              <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
          </div>
          <div class="footer-col">
            <h3>Quick Links</h3>
            <ul>
              <li><a href="#welcome">About Us</a></li>
              <li><a href="#messages">Messages</a></li>
              <li><a href="#events">Events</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h3>Service Times</h3>
            <p><strong>Sundays</strong></p>
            <p>1st Service: 7:00 AM - 10:00 AM</p>
            <p>2nd Service: 10:00 AM - 12:30 PM</p>
            <p><strong>Wednesdays</strong></p>
            <p>Bible Study: 6:00 PM</p>
          </div>
          <div class="footer-col">
            <h3>Contact Us</h3>
            <p><i class="fas fa-map-marker-alt"></i> Still loading..........</p>
            <p><i class="fas fa-phone"></i> (+234) 123 456 7890</p>
            <p><i class="fas fa-envelope"></i> info@church.com</p>
            <p style="margin-top: 15px">
              <a
                href="login.html"
                title="Admin Login"
                style="color: #333; font-size: 0.8rem"
                ><i class="fas fa-lock"></i> Admin</a
              >
            </p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 Perfection Of Christ Ministry. All Rights Reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      // API Base URL
      const API_URL = "/api";

      // Script to change header background on scroll
      const header = document.querySelector(".main-header");
      const welcomeSection = document.getElementById("welcome");

      window.addEventListener("scroll", () => {
        const scrollY = window.scrollY;

        // Sticky Header Background
        if (scrollY > 300) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });

      // Active Link Highlighting
      const sections = document.querySelectorAll("section");
      const navLinks = document.querySelectorAll(
        ".main-nav ul li a:not(.button)",
      );

      window.addEventListener("scroll", () => {
        let current = "";
        sections.forEach((section) => {
          const sectionTop = section.offsetTop;
          if (window.scrollY >= sectionTop - 150) {
            current = section.getAttribute("id");
          }
        });

        navLinks.forEach((link) => {
          link.classList.remove("active");
          if (current && link.getAttribute("href").includes(current)) {
            link.classList.add("active");
          }
        });
      });

      // TypeWriter Class
      // Adapted from ADG-VIT/Portfolio-Website-3
      // Original source: https://github.com/ADG-VIT/Portfolio-Website-3
      // Licensed under MIT License
      // Permission is hereby granted, free of charge, to use this code
      // in accordance with the MIT License terms.
      class TypeWriter {
        constructor(txtElement, words, wait = 3000) {
          this.txtElement = txtElement;
          this.words = Array.isArray(words) ? words : [];
          this.txt = "";
          this.wordIndex = 0;
          this.wait = parseInt(wait, 10);
          this.type();
          this.isDeleting = false;
        }

        type() {
          const current = this.wordIndex % this.words.length;
          const fullTxt = this.words[current];

          if (this.isDeleting) {
            this.txt = fullTxt.substring(0, this.txt.length - 1);
          } else {
            this.txt = fullTxt.substring(0, this.txt.length + 1);
          }

          this.txtElement.innerHTML = `<span class="txt">${this.txt}</span>`;

          let typeSpeed = 300;

          if (this.isDeleting) {
            typeSpeed /= 2;
          }

          if (!this.isDeleting && this.txt === fullTxt) {
            typeSpeed = this.wait;
            this.isDeleting = true;
          } else if (this.isDeleting && this.txt === "") {
            this.isDeleting = false;
            this.wordIndex++;
            typeSpeed = 1000;
          }

          setTimeout(() => this.type(), typeSpeed);
        }
      }

      // Init TypeWriter
      document.addEventListener("DOMContentLoaded", () => {
        const txtElement = document.querySelector(".txt-type");
        if (txtElement) {
          const words = JSON.parse(txtElement.getAttribute("data-words"));
          const wait = txtElement.getAttribute("data-wait");
          new TypeWriter(txtElement, words, wait);
        }
      });

      // --- Events Section Intro Animation ---
      const eventsSection = document.getElementById("events");

      if (eventsSection) {
        const eventsObserver = new IntersectionObserver(
          (entries, observer) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                eventsSection.classList.add("in-view");
                observer.unobserve(entry.target); // Animate only once
              }
            });
          },
          { threshold: 0.2 }, // Trigger when 20% of the section is visible
        );

        eventsObserver.observe(eventsSection);
      }

      // --- General Scroll Animations (Reveal on Scroll) ---
      const scrollObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("active");
            }
          });
        },
        { threshold: 0.1 },
      );

      document.querySelectorAll(".reveal-up, .reveal-scale").forEach((el) => {
        scrollObserver.observe(el);
      });

      // --- Dynamic Flyers System (Shuffle Animation) ---
      async function loadFlyers() {
        const stackContainer = document.getElementById("flyer-stack");
        if (!stackContainer) return;

        try {
          const response = await fetch(`${API_URL}/flyers`);
          const flyers = await response.json();

          let html = "";
          flyers.forEach((flyer) => {
            html += `<div class="flyer-card flyer-enter"><img src="${flyer.image}" alt="Service Flyer"></div>`;
          });
          stackContainer.innerHTML = html;

          // Animate cards in sequence
          const cards = stackContainer.querySelectorAll(".flyer-card");
          cards.forEach((card, index) => {
            setTimeout(
              () => {
                card.classList.remove("flyer-enter");
              },
              index * 1000 + 500,
            );
          });

          // Function to shuffle top card
          const shuffleTopCard = () => {
            const cards = document.querySelectorAll(".flyer-card");
            if (cards.length > 1) {
              const topCard = cards[0];
              topCard.classList.add("shuffle-out");

              setTimeout(() => {
                stackContainer.appendChild(topCard); // Move to bottom
                topCard.classList.remove("shuffle-out");
                // Reset inline styles if any
                topCard.style.transform = "";
                topCard.style.transition = "";
                topCard.style.opacity = "";
              }, 1500);
            }
          };

          // Auto Shuffle Loop
          let autoShuffleInterval;
          setTimeout(
            () => {
              autoShuffleInterval = setInterval(shuffleTopCard, 6000);
            },
            cards.length * 1000 + 2000,
          );

          // --- Swipe & Drag Logic ---
          let startX = 0;
          let isDragging = false;
          let currentTopCard = null;

          const dragStart = (e) => {
            if (
              e.target.closest(".flyer-card") !==
              document.querySelector(".flyer-card:first-child")
            )
              return;

            const cards = document.querySelectorAll(".flyer-card");
            if (cards.length <= 1) return;

            currentTopCard = cards[0];
            currentTopCard.style.cursor = "grabbing";

            startX = e.clientX || e.touches[0].clientX;
            isDragging = true;

            clearInterval(autoShuffleInterval);
            currentTopCard.style.transition = "none";
          };

          const dragging = (e) => {
            if (!isDragging || !currentTopCard) return;
            e.preventDefault(); // Prevent scrolling while dragging

            const currentX = e.clientX || e.touches[0].clientX;
            const diffX = currentX - startX;

            currentTopCard.style.transform = `translateX(${diffX}px) rotate(${diffX * 0.05}deg)`;
          };

          const dragEnd = (e) => {
            if (!isDragging || !currentTopCard) return;

            currentTopCard.style.cursor = "grab";
            isDragging = false;

            const endX =
              e.clientX !== undefined ? e.clientX : e.changedTouches[0].clientX;
            const diffX = endX - startX;
            const threshold = 100;

            if (Math.abs(diffX) > threshold) {
              // Swipe Success
              const direction = diffX > 0 ? 1 : -1;
              currentTopCard.style.transition =
                "transform 1s ease-out, opacity 1s";
              currentTopCard.style.transform = `translateX(${direction * 120}%) rotate(${direction * 20}deg)`;
              currentTopCard.style.opacity = "0";

              setTimeout(() => {
                currentTopCard.style.transition = "";
                currentTopCard.style.transform = "";
                currentTopCard.style.opacity = "";
                stackContainer.appendChild(currentTopCard);
                currentTopCard = null;
              }, 1000);
            } else {
              // Swipe Cancel
              currentTopCard.style.transition = "transform 0.8s ease-out";
              currentTopCard.style.transform = "";
              setTimeout(() => {
                currentTopCard.style.transition = "";
                currentTopCard = null;
              }, 800);
            }

            autoShuffleInterval = setInterval(shuffleTopCard, 6000);
          };

          // Mouse Events
          stackContainer.addEventListener("mousedown", dragStart);
          window.addEventListener("mousemove", dragging);
          window.addEventListener("mouseup", dragEnd);

          // Touch Events
          stackContainer.addEventListener("touchstart", dragStart, {
            passive: false,
          }); // passive: false to allow preventDefault
          stackContainer.addEventListener("touchmove", dragging, {
            passive: false,
          });
          stackContainer.addEventListener("touchend", dragEnd);
        } catch (error) {
          console.error("Error loading flyers:", error);
          stackContainer.innerHTML =
            "<p style='text-align:center; padding-top:200px;'>Unable to load services.</p>";
        }
      }

      // --- Load Live Stream Config ---
      async function loadLiveStream() {
        try {
          const res = await fetch(`${API_URL}/livestream`);
          const config = await res.json();

          if (config.isLive && config.videoId) {
            // Get modal elements
            const liveModal = document.getElementById("live-modal");
            const liveIframe = document.getElementById("live-video-iframe");
            const liveChatIframe = document.getElementById("live-chat-iframe");
            const closeLiveModalBtn = document.querySelector(".live-close-btn");

            // Show live buttons/links
            const liveButton = document.querySelector(".btn-live");
            const liveNavItem = document.querySelector(".live-nav-item");

            const openLiveModal = () => {
              const encodedUrl = encodeURIComponent(config.videoId);
              // Use a responsive width for the plugin
              liveIframe.src = `https://www.facebook.com/plugins/video.php?href=${encodedUrl}&show_text=false&width=734&autoplay=true`;
              liveChatIframe.src = `https://www.facebook.com/plugins/comments.php?href=${encodedUrl}&numposts=10&width=100%25`;
              liveModal.style.display = "block";
            };

            const closeLiveModal = () => {
              liveModal.style.display = "none";
              liveIframe.src = ""; // Stop video playback
              liveChatIframe.src = "";
            };

            if (liveButton) {
              liveButton.style.display = "inline-flex";
              liveButton.href = "#"; // Prevent navigation
              liveButton.addEventListener("click", (e) => {
                e.preventDefault();
                openLiveModal();
              });
            }
            if (liveNavItem) {
              liveNavItem.style.display = "block";
              const navLink = liveNavItem.querySelector("a");
              if (navLink) {
                navLink.href = "#"; // Prevent navigation
                navLink.addEventListener("click", (e) => {
                  e.preventDefault();
                  openLiveModal();
                });
              }
            }

            closeLiveModalBtn.addEventListener("click", closeLiveModal);
            window.addEventListener("click", (e) => {
              if (e.target == liveModal) {
                closeLiveModal();
              }
            });

            // Check for #live hash on page load
            if (window.location.hash === "#live") {
              openLiveModal();
            }
          }
        } catch (e) {
          console.error("Error loading live stream config", e);
        }
      }

      // --- Dynamic Messages System (From Database) ---
      const messagesTrack = document.getElementById("dynamic-messages-list");
      async function loadMessages() {
        if (!messagesTrack) return;

        try {
          const response = await fetch(`${API_URL}/sermons`);
          const messages = await response.json();

          const createCard = (msg) => `
              <div class="message-card">
                <div class="message-thumbnail">
                    <img src="${msg.image}" alt="${msg.title}" />
                    <a href="#" class="play-overlay open-message-modal" data-videourl="${msg.videoUrl}" data-title="${msg.title}"><i class="fas fa-play"></i></a>
                </div>
                <div class="message-content">
                  <h3>${msg.title}</h3>
                  <p class="message-meta">
                    ${msg.preacher} <br> ${msg.date}
                  </p>
                  <a href="#" class="button btn-sm open-message-modal" data-videourl="${msg.videoUrl}" data-title="${msg.title}">Watch Video</a>
                </div>
              </div>
            `;

          // Duplicate content for seamless scrolling loop
          // We map twice to create the infinite effect
          let html = messages.map(createCard).join("");
          html += messages.map(createCard).join("");

          messagesTrack.innerHTML = html;
        } catch (error) {
          console.error("Error loading messages:", error);
          messagesTrack.innerHTML =
            "<p style='color:white;'>Unable to load messages.</p>";
        }
      }

      // --- Message Modal Logic ---
      const messageModal = document.getElementById("message-modal");
      const messageCloseBtn = document.querySelector(".message-close-btn");
      const messageVideoContainer = document.getElementById(
        "message-video-container",
      );
      const messageModalTitle = document.getElementById("message-modal-title");

      function getEmbedUrl(url) {
        let embedUrl = "";
        try {
          const urlObj = new URL(url);
          if (urlObj.hostname.includes("facebook.com")) {
            // Facebook video
            embedUrl = `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=false&width=734&autoplay=true`;
          } else if (
            urlObj.hostname.includes("youtube.com") ||
            urlObj.hostname.includes("youtu.be")
          ) {
            // YouTube video
            let videoId;
            if (urlObj.hostname.includes("youtu.be")) {
              videoId = urlObj.pathname.slice(1);
            } else {
              videoId = urlObj.searchParams.get("v");
            }
            if (videoId) {
              embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            }
          }
        } catch (e) {
          console.error("Invalid video URL:", e);
          return null;
        }
        return embedUrl;
      }

      function openMessageModal(videoUrl, title) {
        const embedUrl = getEmbedUrl(videoUrl);
        if (!embedUrl) {
          alert("Sorry, this video link is not valid or supported.");
          return;
        }
        messageModalTitle.innerText = title;
        messageVideoContainer.innerHTML = `<iframe src="${embedUrl}" width="100%" height="100%" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share" allowfullscreen="true"></iframe>`;
        messageModal.style.display = "block";
      }

      function closeMessageModal() {
        messageModal.style.display = "none";
        messageVideoContainer.innerHTML = ""; // Stop video
      }

      if (messagesTrack) {
        messagesTrack.addEventListener("click", (e) => {
          const trigger = e.target.closest(".open-message-modal");
          if (trigger) {
            e.preventDefault();
            const videoUrl = trigger.dataset.videourl;
            const title = trigger.dataset.title;
            openMessageModal(videoUrl, title);
          }
        });
      }

      if (messageCloseBtn)
        messageCloseBtn.addEventListener("click", closeMessageModal);

      // Initialize Data Loading
      loadFlyers();
      loadMessages();
      loadLiveStream();

      // Prayer Modal Logic
      const prayerModal = document.getElementById("prayer-modal");
      const prayerBtn = document.getElementById("prayer-btn");
      const prayerCloseBtn = prayerModal
        ? prayerModal.querySelector(".close-btn")
        : null;

      if (prayerBtn && prayerModal) {
        prayerBtn.addEventListener("click", (e) => {
          e.preventDefault();
          prayerModal.style.display = "block";
        });
      }
      if (prayerCloseBtn && prayerModal) {
        prayerCloseBtn.addEventListener("click", () => {
          prayerModal.style.display = "none";
        });
      }

      // Back to Top Button
      const backToTopBtn = document.getElementById("back-to-top");

      window.addEventListener("scroll", () => {
        if (window.scrollY > 300) {
          backToTopBtn.classList.add("show");
        } else {
          backToTopBtn.classList.remove("show");
        }
      });

      backToTopBtn.addEventListener("click", (e) => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      window.addEventListener("click", (e) => {
        if (e.target == prayerModal) {
          prayerModal.style.display = "none";
        }
        if (e.target == messageModal) {
          closeMessageModal();
        }
      });

      // --- Handle Prayer Form Submission ---
      const prayerForm = document.getElementById("prayer-form");
      if (prayerForm) {
        prayerForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const submitBtn = prayerForm.querySelector("button[type='submit']");
          const originalBtnText = submitBtn.innerText;
          submitBtn.innerText = "Sending...";
          submitBtn.disabled = true;

          const name = document.getElementById("prayer-name").value;
          const email = document.getElementById("prayer-email").value;
          const request = document.getElementById("prayer-request").value;

          try {
            // Send data to our custom server
            const response = await fetch(`${API_URL}/prayer-requests`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name, email, request }),
            });

            if (response.ok) {
              alert(
                "Prayer request sent successfully! We will be praying for you.",
              );
              prayerForm.reset();
              prayerModal.style.display = "none";
            } else {
              throw new Error("Server responded with an error");
            }
          } catch (error) {
            console.error("Error adding document: ", error);
            alert(
              "Error sending request. Check your internet connection or API keys.",
            );
          } finally {
            submitBtn.innerText = originalBtnText;
            submitBtn.disabled = false;
          }
        });
      }

      // Mobile Menu Toggle
      const menuBtn = document.querySelector(".menu-btn");
      const mainNav = document.querySelector(".main-nav ul");

      if (menuBtn && mainNav) {
        menuBtn.addEventListener("click", () => {
          mainNav.classList.toggle("show");
          // Toggle icon between bars and times
          const icon = menuBtn.querySelector("i");
          if (mainNav.classList.contains("show")) {
            icon.classList.remove("fa-bars");
            icon.classList.add("fa-times");
          } else {
            icon.classList.remove("fa-times");
            icon.classList.add("fa-bars");
          }
        });
      }

      // --- Welcome Section Auto-Type Animation ---
      const welcomeParagraph = document.getElementById("welcome-text");
      const welcomeSectionEl = document.getElementById("welcome");

      if (welcomeParagraph && welcomeSectionEl) {
        const textToType = welcomeParagraph.innerText
          .replace(/\s+/g, " ")
          .trim();
        let hasTyped = false;

        // Create a span inside the paragraph to hold the text and cursor
        // but first, clear the original paragraph content
        welcomeParagraph.innerHTML = '<span class="typed-text"></span>';
        const typedTextSpan = welcomeParagraph.querySelector(".typed-text");

        const typeWriterObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              // Start typing when 50% of the section is visible
              if (entry.isIntersecting && !hasTyped) {
                hasTyped = true;
                typedTextSpan.classList.add("typing-cursor");

                let i = 0;
                const typeInterval = setInterval(() => {
                  typedTextSpan.textContent += textToType.charAt(i);
                  i++;
                  if (i >= textToType.length) {
                    clearInterval(typeInterval);
                    // Remove cursor after a short delay
                    setTimeout(() => {
                      typedTextSpan.classList.remove("typing-cursor");
                    }, 1500);
                  }
                }, 80); // Typing speed (ms) - slower
              }
            });
          },
          { threshold: 0.5 },
        );

        typeWriterObserver.observe(welcomeSectionEl);
      }
    </script>
  </body>
</html>
